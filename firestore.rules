rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // market_sentiment 컬렉션에 대한 규칙
    match /market_sentiment/{document=**} {
      
      // 1. 읽기: 누구나 가능 (통계 보여줘야 하니까)
      allow read: if true;
      
      // 2. 쓰기(Create): 아래 조건을 만족할 때만 허용
      // - 로그인 없이도 작성 가능 (public)
      // - 단, 봇 데이터를 위조하지 못하게 type은 반드시 'human'이어야 함
      // - 필수 데이터(포지션, 전망)가 포함되어 있는지 검증
      allow create: if request.resource.data.type == 'human'
                    && request.resource.data.myPosition >= 0
                    && request.resource.data.myPosition <= 100
                    && request.resource.data.myOutlook != null;

      // 3. 수정(Update) 및 삭제(Delete): 금지
      // - 한 번 쓴 데이터는 위변조 할 수 없음 (이력 보존)
      allow update, delete: if false;
    }
  }
}